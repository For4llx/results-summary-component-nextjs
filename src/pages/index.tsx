import Head from 'next/head'
import { useEffect, useState } from 'react'
import { ICategory } from '@/interfaces'
import styled from 'styled-components'
import { ThemeProvider } from 'styled-components'
import { theme } from '../../styles/Theme'
import { GlobalStyles } from '../../styles/Global'
import ResultSummary from '@/components/ResultsSummary'

const ResultSummaryContainer = styled.section`
  display: flex;
  background-color: ${props => props.theme.white};
  border-radius: 32px;
  box-shadow: 0px 30px 60px hsl(224, 82%, 58%, 15%);
`;

export default function Home() {
  const [categories, setCategories] = useState<Array<ICategory>>([])
  const [score, setScore] = useState(0)

  const fetchCategories = () => {
    useEffect(() => {
      fetch("http://localhost:3000/api/categories")
      .then(response => response.json())
      .then(setCategories)
    }, [])
  }

  const getScore = () => {
    useEffect(() => {
      const scores = categories.map((category) => category.score)
      const sumOfScores = scores.reduce((previousScore, currentScore) => previousScore + currentScore, 0)
      const score = Math.round(sumOfScores / scores.length)
      setScore(score)
    }, [categories])
  }

  fetchCategories()
  getScore()

  return (
    <ThemeProvider theme={theme}>
      <GlobalStyles />
      <Head>
        <title>Results Component Summary</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <ResultSummaryContainer>
          <ResultSummary 
            score={score}
            categories={categories}
          />
        </ResultSummaryContainer>
      </main>
    </ThemeProvider>
  )
}
